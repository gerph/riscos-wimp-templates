/*******************************************************************
 * File:        main
 * Purpose:     WimpTemplates command line tool
 * Author:      Gerph
 ******************************************************************/

#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#include "templates.h"

#include "VersionNum"

#define DEBUG

#ifdef DEBUG
#define dprintf if (1) printf
#else
#define dprintf if (0) printf
#endif


int main(int argc, char *argv[])
{
    opentemplate_t *ot;
    const char *filename;
    printf("WimpTemplates " Module_FullVersionAndDate "\n");
    if (argc < 2)
    {
        printf("Syntax: WimpTemplates <filename>\n");
        exit(1);
    }

    filename = argv[1];

    ot = templates_open(filename);
    if (!ot)
    {
        printf("Failed to open file\n");
    }

    {
        templateerror_t terr;
        uint8_t window[1024];
        uint8_t indirect[1024];
        bufferdata_t bufwin;
        bufferdata_t bufind;

        bufferdata_init(&bufwin, &window[0], sizeof(window));
        bufferdata_init(&bufind, &indirect[0], sizeof(indirect));

        terr = templates_readtemplate(ot, 0, &bufwin, &bufind);
        if (terr)
            printf("Error reading template: %i\n", terr);
        printf("window buffer space needed: %i\n", bufferdata_required(&bufwin));
        printf("window buffer: %p\n", window);
        printf("indirect buffer space needed: %i\n", bufferdata_required(&bufind));
        printf("indirect buffer: %p\n", indirect);
    }

    templates_close(ot);

    exit(EXIT_SUCCESS);
}
